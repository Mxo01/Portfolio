<form class="milestone-form">
	@if (isNew()) {
		<p-floatlabel
			variant="on"
			class="fluid-input"
		>
			<p-select
				id="type"
				appendTo="body"
				[options]="milestoneTypes"
				[field]="milestoneForm.type"
			/>
			<label for="type">Type</label>
		</p-floatlabel>
	}

	<p-floatlabel
		variant="on"
		class="fluid-input"
	>
		<input
			id="title"
			type="text"
			pInputText
			[field]="milestoneForm.title"
		/>
		<label for="title">Title</label>
	</p-floatlabel>

	<p-floatlabel
		variant="on"
		class="fluid-input"
	>
		<input
			id="description"
			type="text"
			pInputText
			[field]="milestoneForm.description"
		/>
		<label for="description">Description</label>
	</p-floatlabel>

	@if (milestoneForm().value().type !== MilestoneEnum.PROJECT) {
		<p-floatlabel
			variant="on"
			class="fluid-input"
		>
			<input
				id="location"
				type="text"
				pInputText
				[field]="milestoneForm.location!"
			/>
			<label for="location">Location</label>
		</p-floatlabel>
	}

	<p-floatlabel
		variant="on"
		class="fluid-input"
	>
		<input
			id="period"
			type="text"
			pInputText
			[field]="milestoneForm.period"
		/>
		<label for="period">Period</label>
	</p-floatlabel>

	<p-floatlabel
		variant="on"
		class="fluid-input"
	>
		<input
			id="milestone-date"
			type="text"
			pInputText
			[field]="milestoneForm.milestoneDate"
		/>
		<label for="milestone-date">Milestone Date</label>
	</p-floatlabel>

	<p-floatlabel
		variant="on"
		class="fluid-input"
	>
		<p-autocomplete
			inputId="tags"
			multiple
			[typeahead]="false"
			[field]="milestoneForm.tags"
		/>
		<label for="tags">Tags</label>
	</p-floatlabel>

	@if (milestoneForm().value().type === MilestoneEnum.PROJECT) {
		<portfolio-reorderable-logos
			[logos]="milestoneForm().value().media || []"
			[isMobile]="isMobile()"
			(logosUpdate)="onNewMilestoneMediaUpdate($event)"
		>
			<div
				header
				class="subheader-with-action-btn"
			>
				<b>Media</b>

				<p-button
					label="Add"
					icon="pi pi-plus"
					severity="secondary"
					size="small"
					(onClick)="addMedia()"
				/>
			</div>
		</portfolio-reorderable-logos>

		<portfolio-reorderable-logos
			[logos]="milestoneForm().value().contributors || []"
			[isMobile]="isMobile()"
			(logosUpdate)="onNewMilestoneContributorsUpdate($event)"
		>
			<div
				header
				class="subheader-with-action-btn"
			>
				<b>Contributors</b>

				<p-button
					label="Add"
					icon="pi pi-plus"
					severity="secondary"
					size="small"
					(onClick)="addContributor()"
				/>
			</div>
		</portfolio-reorderable-logos>
	}

	@if (milestoneForm().value().type === MilestoneEnum.EXPERIENCE) {
		<div class="logo-upload-container">
			<b>Logo</b>

			<div class="milestone-logo-upload">
				<div>
					<p-avatar
						shape="circle"
						[image]="milestoneForm().value().logo?.url"
						[icon]="milestoneForm().value().logo?.url ? undefined : 'pi pi-image'"
						[size]="isMobile() ? 'normal' : 'large'"
						[pTooltip]="milestoneForm().value().logo?.name"
						tooltipPosition="bottom"
					/>
				</div>

				<p-fileupload
					mode="basic"
					chooseIcon="pi pi-upload"
					accept="image/*"
					[auto]="true"
					url="https://www.primefaces.org/cdn/api/upload.php"
					(onUpload)="onMilestoneLogoUpload($event)"
				/>
			</div>
		</div>

		<div class="subheader-with-action-btn">
			<span>Updates</span>

			<p-button
				label="Add"
				icon="pi pi-plus"
				severity="secondary"
				size="small"
				(onClick)="addMilestoneUpdate()"
			/>
		</div>

		@for (update of milestoneUpdates(); track $index) {
			<div class="milestone-update">
				<p-button
					variant="text"
					icon="pi pi-chevron-up"
					size="small"
					[disabled]="$first"
					(onClick)="moveMilestoneUpdate(milestoneUpdates(), $index, 'up')"
				/>

				<p-button
					variant="text"
					icon="pi pi-chevron-down"
					size="small"
					[disabled]="$last"
					(onClick)="moveMilestoneUpdate(milestoneUpdates(), $index, 'down')"
				/>

				<p-floatlabel
					variant="on"
					class="fluid-input"
				>
					<input
						[id]="'update-title-' + $index"
						type="text"
						pInputText
						[(ngModel)]="update.title"
						[ngModelOptions]="{ standalone: true }"
					/>
					<label [for]="'update-title-' + $index">Title</label>
				</p-floatlabel>

				<p-floatlabel
					variant="on"
					class="fluid-input"
				>
					<input
						[id]="'update-duration-' + $index"
						type="text"
						pInputText
						[(ngModel)]="update.duration"
						[ngModelOptions]="{ standalone: true }"
					/>
					<label [for]="'update-duration-' + $index">Duration</label>
				</p-floatlabel>

				<p-button
					severity="danger"
					icon="pi pi-trash"
					size="small"
					(onClick)="removeMilestoneUpdate($index)"
				/>
			</div>
		} @empty {
			<small>No updates yet.</small>
		}
	}
</form>
