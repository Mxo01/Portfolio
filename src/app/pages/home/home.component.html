<main>
	<portfolio-about
		[isAdmin]="isAdmin()"
		[isMobile]="isMobile()"
	/>

	<section class="tabs">
		<p-tabs
			[value]="selectedTab"
			(valueChange)="onTabChange($event)"
		>
			<p-tablist>
				<p-tab
					[value]="TabEnum.EXPERIENCE"
					[routerLink]="paths.EXPERIENCE"
				>
					<i class="pi pi-briefcase"></i>
					<span class="tab-label">Experience</span>
				</p-tab>

				<p-tab
					[value]="TabEnum.EDUCATION"
					[routerLink]="paths.EDUCATION"
				>
					<i class="pi pi-graduation-cap"></i>
					<span class="tab-label">Education</span>
				</p-tab>

				<p-tab
					[value]="TabEnum.PROJECTS"
					[routerLink]="paths.PROJECTS"
				>
					<i class="pi pi-code"></i>
					<span class="tab-label">Projects</span>
				</p-tab>
			</p-tablist>
		</p-tabs>

		<div
			[@routeAnimations]="getRouteAnimationData(outlet)"
			class="outlet-wrapper"
		>
			<router-outlet #outlet="outlet" />
		</div>
	</section>

	<div class="floating-buttons">
		@if (isAdmin()) {
			<p-button
				[size]="isMobile() ? 'small' : 'large'"
				icon="pi pi-plus"
				[rounded]="true"
				(onClick)="addMilestone()"
			/>
		}

		<p-button
			[size]="isMobile() ? 'small' : 'large'"
			[icon]="isDarkMode() ? 'pi pi-sun' : 'pi pi-moon'"
			[rounded]="true"
			(onClick)="toggleDarkMode()"
		/>

		@if (isAdmin()) {
			<p-button
				[size]="isMobile() ? 'small' : 'large'"
				icon="pi pi-sign-out"
				[rounded]="true"
				(onClick)="signOut()"
			/>
		}
	</div>
</main>

@if (isMobile()) {
	<p-drawer
		header="Add Milestone"
		[closable]="false"
		[closeOnEscape]="false"
		[visible]="isAddMilestoneVisible"
		position="bottom"
		[style]="{ height: 'auto' }"
		(onHide)="onAddMilestoneHide()"
	>
		<ng-container [ngTemplateOutlet]="addMilestoneForm" />

		<ng-template #footer>
			<div class="actions">
				<p-button
					[fluid]="true"
					label="Cancel"
					size="small"
					variant="outlined"
					(onClick)="closeAddMilestone()"
				/>

				<p-button
					[fluid]="true"
					label="Add"
					size="small"
					[loading]="isAddMilestoneLoading"
					(onClick)="createMilestone()"
				/>
			</div>
		</ng-template>
	</p-drawer>
} @else {
	<p-dialog
		header="Add Milestone"
		[modal]="true"
		[closable]="false"
		[closeOnEscape]="false"
		[(visible)]="isAddMilestoneVisible"
		(onHide)="onAddMilestoneHide()"
		[style]="{ width: '35rem' }"
	>
		<ng-container [ngTemplateOutlet]="addMilestoneForm" />

		<ng-template #footer>
			<div class="actions">
				<p-button
					[fluid]="true"
					label="Cancel"
					size="small"
					variant="outlined"
					(onClick)="closeAddMilestone()"
				/>

				<p-button
					[fluid]="true"
					label="Add"
					size="small"
					[loading]="isAddMilestoneLoading"
					(onClick)="createMilestone()"
				/>
			</div>
		</ng-template>
	</p-dialog>
}

<ng-template #addMilestoneForm>
	<form
		[formGroup]="milestoneForm"
		class="edit-milestone-form"
	>
		<p-floatlabel
			variant="on"
			class="fluid-input"
		>
			<p-select
				id="type"
				appendTo="body"
				[options]="milestoneTypes"
				formControlName="type"
			/>
			<label for="type">Type</label>
		</p-floatlabel>

		<p-floatlabel
			variant="on"
			class="fluid-input"
		>
			<input
				id="title"
				type="text"
				pInputText
				formControlName="title"
			/>
			<label for="title">Title</label>
		</p-floatlabel>

		<p-floatlabel
			variant="on"
			class="fluid-input"
		>
			<input
				id="description"
				type="text"
				pInputText
				formControlName="description"
			/>
			<label for="description">Description</label>
		</p-floatlabel>

		@if (milestoneForm.value.type !== MilestoneEnum.PROJECT) {
			<p-floatlabel
				variant="on"
				class="fluid-input"
			>
				<input
					id="location"
					type="text"
					pInputText
					formControlName="location"
				/>
				<label for="location">Location</label>
			</p-floatlabel>
		}

		<p-floatlabel
			variant="on"
			class="fluid-input"
		>
			<input
				id="period"
				type="text"
				pInputText
				formControlName="period"
			/>
			<label for="period">Period</label>
		</p-floatlabel>

		<p-floatlabel
			variant="on"
			class="fluid-input"
		>
			<input
				id="milestone-date"
				type="text"
				pInputText
				formControlName="milestoneDate"
			/>
			<label for="milestone-date">Milestone Date</label>
		</p-floatlabel>

		<p-floatlabel
			variant="on"
			class="fluid-input"
		>
			<p-autocomplete
				inputId="tags"
				multiple
				[typeahead]="false"
				formControlName="tags"
			/>
			<label for="tags">Tags</label>
		</p-floatlabel>

		@if (milestoneForm.value.type === MilestoneEnum.PROJECT) {
			<ng-container [ngTemplateOutlet]="mediaTemplate" />
			<ng-container [ngTemplateOutlet]="contributorsTemplate" />
		}

		@if (milestoneForm.value.type === MilestoneEnum.EXPERIENCE) {
			<div class="logo-upload-container">
				<b>Logo</b>

				<div class="milestone-logo-upload">
					<div>
						<p-avatar
							shape="circle"
							[image]="milestoneForm.value.logo?.url"
							[size]="isMobile() ? 'normal' : 'large'"
							[pTooltip]="milestoneForm.value.logo?.name"
							tooltipPosition="bottom"
						/>
					</div>

					<p-fileupload
						mode="basic"
						chooseIcon="pi pi-upload"
						accept="image/*"
						[auto]="true"
						url="https://www.primefaces.org/cdn/api/upload.php"
						(onUpload)="onMilestoneLogoUpload($event)"
					/>
				</div>
			</div>

			<div class="header-with-action-btn">
				<span>Updates</span>

				<p-button
					label="Add"
					icon="pi pi-plus"
					severity="secondary"
					size="small"
					(onClick)="addMilestoneUpdate()"
				/>
			</div>

			@for (update of milestoneUpdates; track $index) {
				<div class="milestone-update">
					<p-button
						variant="text"
						icon="pi pi-chevron-up"
						size="small"
						[disabled]="$first"
						(onClick)="moveMilestoneUpdateUp($index, $first)"
					/>

					<p-button
						variant="text"
						icon="pi pi-chevron-down"
						size="small"
						[disabled]="$last"
						(onClick)="moveMilestoneUpdateDown($index, $last)"
					/>

					<p-floatlabel
						variant="on"
						class="fluid-input"
					>
						<input
							[id]="'update-title-' + $index"
							type="text"
							pInputText
							[(ngModel)]="update.title"
							[ngModelOptions]="{ standalone: true }"
						/>
						<label [for]="'update-title-' + $index">Title</label>
					</p-floatlabel>

					<p-floatlabel
						variant="on"
						class="fluid-input"
					>
						<input
							[id]="'update-duration-' + $index"
							type="text"
							pInputText
							[(ngModel)]="update.duration"
							[ngModelOptions]="{ standalone: true }"
						/>
						<label [for]="'update-duration-' + $index">Duration</label>
					</p-floatlabel>

					<p-button
						severity="danger"
						icon="pi pi-trash"
						size="small"
						(onClick)="removeMilestoneUpdate($index)"
					/>
				</div>
			} @empty {
				<small>No updates yet.</small>
			}
		}
	</form>
</ng-template>

<ng-template #mediaTemplate>
	<div class="reorderable-logo-container">
		<div class="header-with-action-btn">
			<b>Media</b>

			<p-button
				label="Add"
				icon="pi pi-plus"
				severity="secondary"
				size="small"
				(onClick)="addMedia()"
			/>
		</div>

		@for (media of milestoneForm.value.media; track $index) {
			<div class="logo-item">
				<p-button
					variant="text"
					icon="pi pi-chevron-up"
					size="small"
					[disabled]="$first"
					(onClick)="moveMediaUp($index, $first)"
				/>

				<p-button
					variant="text"
					icon="pi pi-chevron-down"
					size="small"
					[disabled]="$last"
					(onClick)="moveMediaDown($index, $last)"
				/>

				<div>
					<p-avatar
						shape="circle"
						[image]="media.url"
						[size]="isMobile() ? 'normal' : 'large'"
						[pTooltip]="media.name"
						tooltipPosition="bottom"
					/>
				</div>

				<p-fileupload
					mode="basic"
					chooseIcon="pi pi-upload"
					accept="image/*"
					[auto]="true"
					url="https://www.primefaces.org/cdn/api/upload.php"
					(onUpload)="onMediaUpload($event, $index)"
				/>

				<p-floatlabel
					variant="on"
					class="fluid-input"
				>
					<input
						[id]="'media-name-' + $index"
						type="text"
						pInputText
						[(ngModel)]="media.name"
						[ngModelOptions]="{ standalone: true }"
					/>
					<label [for]="'media-name-' + $index">Name</label>
				</p-floatlabel>

				<p-button
					severity="danger"
					icon="pi pi-trash"
					size="small"
					(onClick)="removeMedia($index)"
				/>
			</div>
		} @empty {
			<span>No media yet.</span>
		}
	</div>
</ng-template>

<ng-template #contributorsTemplate>
	<div class="reorderable-logo-container">
		<div class="header-with-action-btn">
			<b>Contributors</b>

			<p-button
				label="Add"
				icon="pi pi-plus"
				severity="secondary"
				size="small"
				(onClick)="addContributor()"
			/>
		</div>

		@for (contributor of milestoneForm.value.contributors; track $index) {
			<div class="logo-item">
				<p-button
					variant="text"
					icon="pi pi-chevron-up"
					size="small"
					[disabled]="$first"
					(onClick)="moveContributorUp($index, $first)"
				/>

				<p-button
					variant="text"
					icon="pi pi-chevron-down"
					size="small"
					[disabled]="$last"
					(onClick)="moveContributorDown($index, $last)"
				/>

				<div>
					<p-avatar
						shape="circle"
						[image]="contributor.url"
						[size]="isMobile() ? 'normal' : 'large'"
						[pTooltip]="contributor.name"
						tooltipPosition="bottom"
					/>
				</div>

				<p-fileupload
					mode="basic"
					chooseIcon="pi pi-upload"
					accept="image/*"
					[auto]="true"
					url="https://www.primefaces.org/cdn/api/upload.php"
					(onUpload)="onContributorUpload($event, $index)"
				/>

				<p-floatlabel
					variant="on"
					class="fluid-input"
				>
					<input
						[id]="'contributor-name-' + $index"
						type="text"
						pInputText
						[(ngModel)]="contributor.name"
						[ngModelOptions]="{ standalone: true }"
					/>
					<label [for]="'contributor-name-' + $index">Name</label>
				</p-floatlabel>

				<p-button
					severity="danger"
					icon="pi pi-trash"
					size="small"
					(onClick)="removeContributor($index)"
				/>
			</div>
		} @empty {
			<span>No contributors yet.</span>
		}
	</div>
</ng-template>
