<main>
	<section class="about">
		<div class="profile">
			<p-avatar
				size="xlarge"
				shape="circle"
				image="images/profile-pic.jpg"
			/>

			<div class="info">
				<span class="name">Mario Di Modica</span>

				<div class="kpis">
					@for (kpi of kpis(); track $index) {
						<portfolio-kpi
							[label]="kpi.label"
							[value]="kpi.value"
						/>
					}
				</div>
			</div>
		</div>

		<span class="description">
			<b>Front-End Software Engineer</b>
			with deep expertise in Angular, RxJS and Signals, crafting scalable and performant web
			applications. Also exploring React and modern UI technologies.
		</span>

		<portfolio-avatar-list
			[avatars]="techStack()"
			[isEditable]="isAdmin()"
			(edit)="onTechStackEdit()"
			description="Tech Stack"
		/>

		<portfolio-avatar-list
			[avatars]="companies()"
			description="Companies where I worked"
			[isCollapsed]="true"
		/>

		<div class="actions">
			<p-button
				label="View CV"
				[fluid]="true"
				[size]="isMobile() ? 'small' : 'large'"
				(onClick)="viewCV()"
				icon="pi pi-external-link"
			/>

			<p-button
				label="Contact me"
				[fluid]="true"
				[size]="isMobile() ? 'small' : 'large'"
				[outlined]="true"
				(onClick)="isMailDrawerVisible = !isMailDrawerVisible"
			/>
		</div>
	</section>

	<section class="tabs">
		<p-tabs
			[value]="selectedTab"
			(valueChange)="onTabChange($event)"
		>
			<p-tablist>
				<p-tab
					[value]="TabEnum.EXPERIENCE"
					[routerLink]="paths.EXPERIENCE"
				>
					<i class="pi pi-briefcase"></i>
					<span class="tab-label">Experience</span>
				</p-tab>

				<p-tab
					[value]="TabEnum.EDUCATION"
					[routerLink]="paths.EDUCATION"
				>
					<i class="pi pi-graduation-cap"></i>
					<span class="tab-label">Education</span>
				</p-tab>

				<p-tab
					[value]="TabEnum.PROJECTS"
					[routerLink]="paths.PROJECTS"
				>
					<i class="pi pi-code"></i>
					<span class="tab-label">Projects</span>
				</p-tab>
			</p-tablist>
		</p-tabs>

		<div
			[@routeAnimations]="getRouteAnimationData(outlet)"
			class="outlet-wrapper"
		>
			<router-outlet #outlet="outlet" />
		</div>
	</section>

	<div class="floating-buttons">
		@if (isAdmin()) {
			<p-button
				[size]="isMobile() ? 'small' : 'large'"
				icon="pi pi-plus"
				[rounded]="true"
				(onClick)="addMilestone()"
			/>
		}

		<p-button
			[size]="isMobile() ? 'small' : 'large'"
			[icon]="isDarkMode() ? 'pi pi-sun' : 'pi pi-moon'"
			[rounded]="true"
			(onClick)="toggleDarkMode()"
		/>

		@if (isAdmin()) {
			<p-button
				[size]="isMobile() ? 'small' : 'large'"
				icon="pi pi-sign-out"
				[rounded]="true"
				(onClick)="signOut()"
			/>
		}
	</div>
</main>

<p-drawer
	header="How to reach me"
	[(visible)]="isMailDrawerVisible"
	position="right"
>
	<div class="contacts-drawer">
		<div>
			<p>
				This is my email address:
				<small>mariodimodica.01&#64;gmail.com</small>
			</p>

			<p class="description">
				You can either copy it or open your default mail app and send me an email!
			</p>

			<div class="actions">
				<p-button
					label="Send"
					icon="pi pi-envelope"
					[fluid]="true"
					[size]="isMobile() ? 'small' : 'large'"
					(onClick)="sendEmail()"
				/>

				<p-button
					label="Copy"
					icon="pi pi-copy"
					[fluid]="true"
					[outlined]="true"
					[size]="isMobile() ? 'small' : 'large'"
					(onClick)="copyEmail()"
				/>
			</div>
		</div>

		<div class="socials">
			<a
				href="https://www.instagram.com/not_mxo/"
				target="_blank"
				rel="noopener noreferrer"
				class="p-button p-button-text"
			>
				<i class="pi pi-instagram"></i>
			</a>

			<a
				href="https://www.linkedin.com/in/mariodimodica/"
				target="_blank"
				rel="noopener noreferrer"
				class="p-button p-button-text"
			>
				<i class="pi pi-linkedin"></i>
			</a>

			<a
				href="https://github.com/Mxo01"
				target="_blank"
				rel="noopener noreferrer"
				class="p-button p-button-text"
			>
				<i class="pi pi-github"></i>
			</a>
		</div>
	</div>
</p-drawer>

@if (isMobile()) {
	<p-drawer
		header="Add Milestone"
		[closable]="false"
		[closeOnEscape]="false"
		[visible]="isAddMilestoneVisible"
		position="bottom"
		[style]="{ height: 'auto' }"
		(onHide)="onAddMilestoneHide()"
	>
		<ng-container [ngTemplateOutlet]="addMilestoneForm" />

		<ng-template #footer>
			<div class="edit-actions">
				<p-button
					[fluid]="true"
					label="Cancel"
					size="small"
					variant="outlined"
					(onClick)="closeAddMilestone()"
				/>

				<p-button
					[fluid]="true"
					[loading]="isAddMilestoneLoading"
					label="Add"
					size="small"
					[loading]="isAddMilestoneLoading"
					(onClick)="createMilestone()"
				/>
			</div>
		</ng-template>
	</p-drawer>

	<p-drawer
		header="Edit Tech Stack"
		[closable]="false"
		[closeOnEscape]="false"
		[visible]="isEditTechStackVisible"
		position="bottom"
		[style]="{ height: 'auto' }"
	>
		<ng-container [ngTemplateOutlet]="editTechStackTemplate" />

		<ng-template #footer>
			<div class="edit-actions">
				<p-button
					[fluid]="true"
					label="Cancel"
					size="small"
					variant="outlined"
					(onClick)="closeEditTechStack()"
				/>

				<p-button
					[fluid]="true"
					label="Save Edits"
					size="small"
					[loading]="isSaveTechStackEditsLoading"
					(onClick)="saveTechStackEdits()"
				/>
			</div>
		</ng-template>
	</p-drawer>
} @else {
	<p-dialog
		header="Add Milestone"
		[modal]="true"
		[closable]="false"
		[closeOnEscape]="false"
		[(visible)]="isAddMilestoneVisible"
		(onHide)="onAddMilestoneHide()"
		[style]="{ width: '35rem' }"
	>
		<ng-container [ngTemplateOutlet]="addMilestoneForm" />

		<ng-template #footer>
			<div class="edit-actions">
				<p-button
					[fluid]="true"
					label="Cancel"
					size="small"
					variant="outlined"
					(onClick)="closeEditTechStack()"
				/>

				<p-button
					[fluid]="true"
					label="Add"
					size="small"
					[loading]="isAddMilestoneLoading"
					(onClick)="saveTechStackEdits()"
				/>
			</div>
		</ng-template>
	</p-dialog>

	<p-dialog
		header="Edit Tech Stack"
		[modal]="true"
		[closable]="false"
		[closeOnEscape]="false"
		[(visible)]="isEditTechStackVisible"
		[style]="{ width: '35rem' }"
	>
		<ng-container [ngTemplateOutlet]="editTechStackTemplate" />

		<ng-template #footer>
			<div class="edit-actions">
				<p-button
					[fluid]="true"
					label="Cancel"
					size="small"
					variant="outlined"
					(onClick)="closeEditTechStack()"
				/>

				<p-button
					[fluid]="true"
					label="Save Edits"
					size="small"
					[loading]="isSaveTechStackEditsLoading"
					(onClick)="saveTechStackEdits()"
				/>
			</div>
		</ng-template>
	</p-dialog>
}

<ng-template #addMilestoneForm>
	<form
		[formGroup]="milestoneForm"
		class="edit-milestone-form"
	>
		<p-floatlabel
			variant="on"
			class="fluid-input"
		>
			<p-select
				id="type"
				[options]="milestoneTypes"
				formControlName="type"
			/>
			<label for="type">Type</label>
		</p-floatlabel>

		<p-floatlabel
			variant="on"
			class="fluid-input"
		>
			<input
				id="title"
				type="text"
				pInputText
				formControlName="title"
			/>
			<label for="title">Title</label>
		</p-floatlabel>

		<p-floatlabel
			variant="on"
			class="fluid-input"
		>
			<input
				id="description"
				type="text"
				pInputText
				formControlName="description"
			/>
			<label for="description">Description</label>
		</p-floatlabel>

		@if (milestoneForm.value.type !== MilestoneEnum.PROJECT) {
			<p-floatlabel
				variant="on"
				class="fluid-input"
			>
				<input
					id="location"
					type="text"
					pInputText
					formControlName="location"
				/>
				<label for="location">Location</label>
			</p-floatlabel>
		}

		<p-floatlabel
			variant="on"
			class="fluid-input"
		>
			<input
				id="period"
				type="text"
				pInputText
				formControlName="period"
			/>
			<label for="period">Period</label>
		</p-floatlabel>

		<p-floatlabel
			variant="on"
			class="fluid-input"
		>
			<input
				id="milestone-date"
				type="text"
				pInputText
				formControlName="milestoneDate"
			/>
			<label for="milestone-date">Milestone Date</label>
		</p-floatlabel>

		<p-floatlabel
			variant="on"
			class="fluid-input"
		>
			<p-autocomplete
				inputId="tags"
				multiple
				[typeahead]="false"
				formControlName="tags"
			/>
			<label for="tags">Tags</label>
		</p-floatlabel>

		@if (milestoneForm.value.type === MilestoneEnum.EXPERIENCE) {
			<div class="logo-upload-container">
				<b>Logo</b>

				<div class="milestone-logo-upload">
					<div>
						<p-avatar
							shape="circle"
							[image]="milestoneForm.value.logo?.url"
							[size]="isMobile() ? 'normal' : 'large'"
							[pTooltip]="milestoneForm.value.logo?.name"
							tooltipPosition="bottom"
						/>
					</div>

					<p-fileupload
						mode="basic"
						chooseIcon="pi pi-upload"
						accept="image/*"
						[auto]="true"
						url="https://www.primefaces.org/cdn/api/upload.php"
						(onUpload)="onMilestoneLogoUpload($event)"
					/>
				</div>
			</div>
		}

		@if (milestoneForm.value.type === MilestoneEnum.EXPERIENCE) {
			<div class="updates-title">
				<b>Updates</b>

				<p-button
					label="Add"
					icon="pi pi-plus"
					severity="secondary"
					size="small"
					(onClick)="addMilestoneUpdate()"
				/>
			</div>

			@for (update of milestoneUpdates; track $index) {
				<div class="milestone-update">
					<p-button
						variant="text"
						icon="pi pi-chevron-up"
						size="small"
						[disabled]="$first"
						(onClick)="moveMilestoneUpdateUp($index, $first)"
					/>

					<p-button
						variant="text"
						icon="pi pi-chevron-down"
						size="small"
						[disabled]="$last"
						(onClick)="moveMilestoneUpdateDown($index, $last)"
					/>

					<p-floatlabel
						variant="on"
						class="fluid-input"
					>
						<input
							[id]="'update-title-' + $index"
							type="text"
							pInputText
							[(ngModel)]="update.title"
							[ngModelOptions]="{ standalone: true }"
						/>
						<label [for]="'update-title-' + $index">Title</label>
					</p-floatlabel>

					<p-floatlabel
						variant="on"
						class="fluid-input"
					>
						<input
							[id]="'update-duration-' + $index"
							type="text"
							pInputText
							[(ngModel)]="update.duration"
							[ngModelOptions]="{ standalone: true }"
						/>
						<label [for]="'update-duration-' + $index">Duration</label>
					</p-floatlabel>

					<p-button
						severity="danger"
						icon="pi pi-trash"
						size="small"
						(onClick)="removeMilestoneUpdate($index)"
					/>
				</div>
			} @empty {
				<small>No updates yet.</small>
			}
		}
	</form>
</ng-template>

<ng-template #editTechStackTemplate>
	<div class="tech-stack-edit-container">
		@for (tech of techStack(); track tech) {
			<div class="technology">
				<p-button
					variant="text"
					icon="pi pi-chevron-up"
					size="small"
					[disabled]="$first"
					(onClick)="moveTechUp($index, $first)"
				/>

				<p-button
					variant="text"
					icon="pi pi-chevron-down"
					size="small"
					[disabled]="$last"
					(onClick)="moveTechDown($index, $last)"
				/>

				<div>
					<p-avatar
						shape="circle"
						[image]="tech.url"
						[size]="isMobile() ? 'normal' : 'large'"
						[pTooltip]="tech.name"
						tooltipPosition="bottom"
					/>
				</div>

				<p-fileupload
					mode="basic"
					chooseIcon="pi pi-upload"
					accept="image/*"
					[auto]="true"
					url="https://www.primefaces.org/cdn/api/upload.php"
					(onUpload)="onTechUpload($event, $index)"
				/>

				<p-floatlabel
					variant="on"
					class="fluid-input"
				>
					<input
						[id]="'tech-name-' + $index"
						type="text"
						pInputText
						[(ngModel)]="tech.name"
						[ngModelOptions]="{ standalone: true }"
					/>
					<label [for]="'tech-name-' + $index">Name</label>
				</p-floatlabel>

				<p-button
					severity="danger"
					icon="pi pi-trash"
					size="small"
					(onClick)="removeTech($index)"
				/>
			</div>
		}
	</div>
</ng-template>
